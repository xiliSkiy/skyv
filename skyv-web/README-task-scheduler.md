# 任务调度器前端更新说明

## 概述

本次更新将前端的任务调度页面从使用mock数据改为直接调用后端API接口，实现了与后端任务调度系统的完整集成。

## 主要更新内容

### 1. API接口更新

#### 1.1 任务管理API (`src/api/task.js`)
- 更新所有接口路径为 `/api/collector/tasks`
- 新增完整的任务管理接口：
  - 任务CRUD操作
  - 任务执行控制
  - 任务状态管理
  - 批量操作
  - 任务监控和统计
  - 配置验证和测试
  - 系统维护功能

#### 1.2 调度器管理API (`src/api/scheduler.js`)
- 新增调度器管理专用API文件
- 提供完整的调度器控制接口：
  - 调度器状态管理
  - 统计信息获取
  - 任务调度控制
  - 系统资源监控
  - 配置管理

### 2. 页面组件更新

#### 2.1 任务列表页面 (`src/views/task/TaskList.vue`)
- 更新API调用，使用新的任务管理接口
- 调整任务状态显示逻辑，适配后端状态值
- 更新任务操作函数，使用新的接口名称
- 优化错误处理和用户反馈

#### 2.2 任务创建页面 (`src/views/task/TaskCreate.vue`)
- 集成任务配置验证功能
- 使用新的任务创建和更新接口
- 优化表单验证流程

#### 2.3 任务调度器管理页面 (`src/views/task/TaskScheduler.vue`)
- 新增调度器管理页面
- 实时监控调度器状态和性能
- 提供调度器控制操作
- 显示已调度任务列表

## 接口映射关系

### 任务管理接口

| 前端功能 | 后端接口 | 说明 |
|---------|---------|------|
| 获取任务列表 | `GET /api/collector/tasks` | 支持分页和筛选 |
| 创建任务 | `POST /api/collector/tasks` | 创建新任务 |
| 更新任务 | `PUT /api/collector/tasks/{id}` | 更新任务信息 |
| 删除任务 | `DELETE /api/collector/tasks/{id}` | 删除指定任务 |
| 执行任务 | `POST /api/collector/tasks/{id}/execute` | 立即执行任务 |
| 启用任务 | `POST /api/collector/tasks/{id}/enable` | 启用任务调度 |
| 禁用任务 | `POST /api/collector/tasks/{id}/disable` | 禁用任务调度 |
| 暂停任务 | `POST /api/collector/tasks/{id}/pause` | 暂停任务执行 |
| 恢复任务 | `POST /api/collector/tasks/{id}/resume` | 恢复任务执行 |
| 批量操作 | `POST /api/collector/tasks/batch-*` | 批量启用/禁用/删除 |
| 任务统计 | `GET /api/collector/tasks/overview-statistics` | 获取任务概览统计 |
| 配置验证 | `POST /api/collector/tasks/validate` | 验证任务配置 |

### 调度器管理接口

| 前端功能 | 后端接口 | 说明 |
|---------|---------|------|
| 获取状态 | `GET /api/collector/scheduler/status` | 调度器运行状态 |
| 启动调度器 | `POST /api/collector/scheduler/start` | 启动任务调度器 |
| 停止调度器 | `POST /api/collector/scheduler/stop` | 停止任务调度器 |
| 获取统计 | `GET /api/collector/scheduler/statistics` | 调度器性能统计 |
| 重新加载 | `POST /api/collector/scheduler/reload` | 重新加载所有任务 |
| 清理任务 | `POST /api/collector/scheduler/cleanup` | 清理过期任务 |
| 健康检查 | `GET /api/collector/scheduler/health` | 调度器健康状态 |

## 状态值映射

### 任务状态

| 后端值 | 前端显示 | 说明 |
|--------|----------|------|
| 1 | 启用 | 任务已启用，可以执行 |
| 0 | 禁用 | 任务已禁用，不会执行 |

### 调度器状态

| 后端值 | 前端显示 | 说明 |
|--------|----------|------|
| RUNNING | 运行中 | 调度器正常运行 |
| STOPPED | 已停止 | 调度器已停止 |
| STARTING | 启动中 | 调度器正在启动 |
| STOPPING | 停止中 | 调度器正在停止 |
| ERROR | 错误 | 调度器出现错误 |

## 使用说明

### 1. 任务管理

1. **查看任务列表**
   - 访问任务列表页面
   - 使用筛选条件查找特定任务
   - 支持分页浏览

2. **创建新任务**
   - 点击"创建任务"按钮
   - 填写任务基本信息
   - 系统自动验证配置
   - 按步骤完成设备选择和指标配置

3. **管理任务状态**
   - 启用/禁用任务
   - 暂停/恢复任务
   - 手动执行任务
   - 批量操作多个任务

### 2. 调度器管理

1. **监控调度器状态**
   - 实时查看调度器运行状态
   - 监控系统资源使用情况
   - 查看任务执行统计

2. **控制调度器**
   - 启动/停止调度器
   - 重新加载任务配置
   - 清理过期任务数据
   - 执行健康检查

3. **查看调度信息**
   - 已调度任务列表
   - 任务执行历史
   - 性能指标报告

## 注意事项

### 1. 权限要求
- 所有接口都需要用户认证
- 不同操作需要相应的权限
- 使用JWT Token进行身份验证

### 2. 错误处理
- 前端统一处理API错误
- 提供友好的错误提示
- 记录详细的错误日志

### 3. 性能优化
- 使用分页加载大量数据
- 实现数据缓存机制
- 定时刷新关键信息

### 4. 兼容性
- 保持与现有代码的兼容性
- 提供旧接口的映射
- 渐进式迁移策略

## 后续计划

### 1. 功能增强
- 添加任务执行进度显示
- 实现实时数据推送
- 支持任务依赖关系

### 2. 用户体验
- 优化页面响应速度
- 添加操作确认提示
- 实现拖拽排序功能

### 3. 监控告警
- 集成告警系统
- 添加性能监控
- 实现自动化运维

## 技术架构

### 前端技术栈
- Vue 3 + Composition API
- Element Plus UI组件库
- Axios HTTP客户端
- Vue Router 路由管理

### 后端集成
- RESTful API接口
- JWT认证机制
- 统一响应格式
- 错误处理规范

### 数据流
1. 用户操作触发前端事件
2. 前端调用相应的API接口
3. 后端处理请求并返回结果
4. 前端更新UI显示最新状态

## 总结

本次更新成功将前端任务调度系统与后端API完全集成，实现了：

- 完整的任务生命周期管理
- 实时的调度器状态监控
- 统一的错误处理和用户反馈
- 良好的代码结构和可维护性

系统现在可以完全依赖后端API，不再需要mock数据，为用户提供了真实、可靠的任务调度管理体验。
