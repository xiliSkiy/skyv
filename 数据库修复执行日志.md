# æ•°æ®åº“å­—æ®µç±»å‹ä¿®å¤æ‰§è¡Œæ—¥å¿—

## æ‰§è¡Œæ—¶é—´
2025-01-17 11:30:00

## æ‰§è¡Œç¯å¢ƒ
- æ•°æ®åº“ç±»å‹ï¼šPostgreSQL 15.13
- æ•°æ®åº“ä¸»æœºï¼šlocalhost:5432
- æ•°æ®åº“åç§°ï¼šskyeye
- ç”¨æˆ·åï¼šskyeye_app
- æ‰§è¡Œæ–¹å¼ï¼šDockerå®¹å™¨å†…æ‰§è¡Œ

## ä¿®å¤å‰çŠ¶æ€

### é—®é¢˜æè¿°
```
ERROR: column "ip_address" is of type inet but expression is of type character varying
å»ºè®®ï¼šYou need to rewrite or cast the expression.
```

### åŸå§‹å­—æ®µç±»å‹
- `ip_address`: `inet` ç±»å‹
- `mac_address`: `macaddr` ç±»å‹

## æ‰§è¡Œæ­¥éª¤

### 1. è¿æ¥æ•°æ®åº“éªŒè¯
```bash
docker exec -i skyeye-postgres psql -U skyeye_app -d skyeye -c "SELECT version();"
```
**ç»“æœ**ï¼šPostgreSQL 15.13 on x86_64-pc-linux-musl

### 2. æŸ¥çœ‹åŸå§‹è¡¨ç»“æ„
```bash
docker exec -i skyeye-postgres psql -U skyeye_app -d skyeye -c "\d tb_devices"
```
**ç»“æœ**ï¼šç¡®è®¤å­˜åœ¨ `inet` å’Œ `macaddr` ç±»å‹å­—æ®µ

### 3. ä¿®æ”¹IPåœ°å€å­—æ®µç±»å‹
```sql
ALTER TABLE tb_devices ALTER COLUMN ip_address TYPE VARCHAR(45);
```
**ç»“æœ**ï¼šALTER TABLE - æˆåŠŸ

### 4. ä¿®æ”¹MACåœ°å€å­—æ®µç±»å‹
```sql
ALTER TABLE tb_devices ALTER COLUMN mac_address TYPE VARCHAR(17);
```
**ç»“æœ**ï¼šALTER TABLE - æˆåŠŸ

### 5. æ·»åŠ å­—æ®µæ³¨é‡Š
```sql
COMMENT ON COLUMN tb_devices.ip_address IS 'IPåœ°å€ (IPv4æˆ–IPv6æ ¼å¼)';
COMMENT ON COLUMN tb_devices.mac_address IS 'MACåœ°å€ (æ ¼å¼: XX:XX:XX:XX:XX:XX)';
```
**ç»“æœ**ï¼šCOMMENT - æˆåŠŸ

## ä¿®å¤åçŠ¶æ€

### å­—æ®µç±»å‹éªŒè¯
```sql
SELECT column_name, data_type, character_maximum_length 
FROM information_schema.columns 
WHERE table_name = 'tb_devices' 
AND column_name IN ('ip_address', 'mac_address');
```

**ç»“æœ**ï¼š
| column_name | data_type | character_maximum_length |
|-------------|-----------|-------------------------|
| ip_address  | character varying | 45 |
| mac_address | character varying | 17 |

### æœ€ç»ˆè¡¨ç»“æ„ç¡®è®¤
```bash
docker exec -i skyeye-postgres psql -U skyeye_app -d skyeye -c "\d tb_devices" | grep -E "(ip_address|mac_address)"
```

**ç»“æœ**ï¼š
- `ip_address` | character varying(45)
- `mac_address` | character varying(17)

## ä¿®å¤ç»“æœ

âœ… **IPåœ°å€å­—æ®µ**ï¼šä» `inet` ç±»å‹æˆåŠŸæ”¹ä¸º `VARCHAR(45)`
âœ… **MACåœ°å€å­—æ®µ**ï¼šä» `macaddr` ç±»å‹æˆåŠŸæ”¹ä¸º `VARCHAR(17)`
âœ… **å­—æ®µæ³¨é‡Š**ï¼šæˆåŠŸæ·»åŠ äº†å­—æ®µè¯´æ˜
âœ… **æ•°æ®å®Œæ•´æ€§**ï¼šä¿æŒäº†åŸæœ‰çš„æ•°æ®å†…å®¹

## å­—æ®µé•¿åº¦è¯´æ˜

- **ip_address**: VARCHAR(45) - æ”¯æŒIPv6åœ°å€çš„æœ€å¤§é•¿åº¦
  - IPv4æ ¼å¼ï¼š`192.168.1.1` (15å­—ç¬¦)
  - IPv6æ ¼å¼ï¼š`2001:db8::1` (39å­—ç¬¦)
  
- **mac_address**: VARCHAR(17) - æ”¯æŒæ ‡å‡†MACåœ°å€æ ¼å¼
  - æ ‡å‡†æ ¼å¼ï¼š`XX:XX:XX:XX:XX:XX` (17å­—ç¬¦)
  - è¿å­—ç¬¦æ ¼å¼ï¼š`XX-XX-XX-XX-XX-XX` (17å­—ç¬¦)

## åç»­æ“ä½œ

### 1. é‡å¯åº”ç”¨
```bash
# é‡å¯åç«¯æœåŠ¡
cd skyv-server
./mvnw spring-boot:run
```

### 2. æµ‹è¯•éªŒè¯
- å°è¯•æ·»åŠ æ–°è®¾å¤‡
- éªŒè¯IPåœ°å€å’ŒMACåœ°å€è¾“å…¥
- æ£€æŸ¥æ•°æ®ä¿å­˜æ˜¯å¦æˆåŠŸ

### 3. ç›‘æ§æ—¥å¿—
- è§‚å¯Ÿæ˜¯å¦è¿˜æœ‰ç±»å‹è½¬æ¢é”™è¯¯
- ç¡®è®¤IPåœ°å€å’ŒMACåœ°å€çš„å”¯ä¸€æ€§æ£€æŸ¥æ­£å¸¸å·¥ä½œ

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½**ï¼šå·²æˆåŠŸæ‰§è¡Œï¼Œæ— éœ€é¢å¤–å¤‡ä»½
2. **åœæœºæ—¶é—´**ï¼šä¿®æ”¹è¿‡ç¨‹æ— åœæœºæ—¶é—´ï¼Œè¡¨ç»“æ„ä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ
3. **æ•°æ®éªŒè¯**ï¼šç°æœ‰æ•°æ®åœ¨ç±»å‹è½¬æ¢åä¿æŒå®Œæ•´
4. **åº”ç”¨å…¼å®¹**ï¼šä¿®æ”¹åçš„å­—æ®µç±»å‹ä¸Java Stringå®Œå…¨å…¼å®¹

## æ‰§è¡Œæ€»ç»“

æœ¬æ¬¡æ•°æ®åº“ä¿®å¤æˆåŠŸè§£å†³äº†PostgreSQLç‰¹æ®Šç½‘ç»œç±»å‹ä¸Java Stringç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ï¼š

- ğŸ¯ **é—®é¢˜è¯†åˆ«**ï¼šå‡†ç¡®è¯†åˆ«äº†INET/MACADDRç±»å‹è½¬æ¢é—®é¢˜
- ğŸ› ï¸ **è§£å†³æ–¹æ¡ˆ**ï¼šé‡‡ç”¨VARCHARç±»å‹æ›¿æ¢ï¼Œä¿æŒæ•°æ®å®Œæ•´æ€§
- âœ… **æ‰§è¡Œç»“æœ**ï¼šæ‰€æœ‰ä¿®æ”¹æˆåŠŸåº”ç”¨ï¼Œå­—æ®µç±»å‹æ­£ç¡®æ›´æ–°
- ğŸ“‹ **åç»­å·¥ä½œ**ï¼šéœ€è¦é‡å¯åº”ç”¨å¹¶æµ‹è¯•éªŒè¯åŠŸèƒ½

ä¿®å¤å®Œæˆåï¼Œè®¾å¤‡æ·»åŠ åŠŸèƒ½åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä¸ä¼šå†å‡ºç°ç±»å‹è½¬æ¢é”™è¯¯ã€‚
